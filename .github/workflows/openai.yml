name: OpenAI Automation

on:
  schedule:
    - cron: "0 0 * * 0"  # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 00:00 UTC
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

permissions:
  contents: write

jobs:
  openai-task:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Call OpenAI API
        run: |
          echo "Calling OpenAI API..."
          RESPONSE=$(curl -s -X POST "https://api.openai.com/v1/completions" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.OPENAI_API_KEY }}" \
            -d '{
              "model": "gpt-4",
              "prompt": "Generate a short and informative summary of my GitHub contributions for this week.",
              "temperature": 0.7,
              "max_tokens": 150
            }' | jq -r '.choices[0].text')

          if [[ -z "$RESPONSE" || "$RESPONSE" == "null" ]]; then
            echo "‚ö†Ô∏è OpenAI API returned an empty response. Skipping update."
            exit 1
          fi

          echo "### üß† AI Weekly Summary" > ai_summary.md
          echo "$RESPONSE" >> ai_summary.md

      - name: Update README with AI Summary
        run: |
          echo "Updating README.md..."
          sed -i '/<!-- START_AI_SUMMARY -->/,/<!-- END_AI_SUMMARY -->/c\
          <!-- START_AI_SUMMARY -->\n'"$(cat ai_summary.md)"'\n<!-- END_AI_SUMMARY -->' README.md

      - name: Commit and Push Changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

          git add ai_summary.md README.md
          if git diff --cached --quiet; then
            echo "‚ö° No changes to commit"
            exit 0
          fi
          
          git commit -m "üìù Auto-update AI Weekly Summary"
          git push
