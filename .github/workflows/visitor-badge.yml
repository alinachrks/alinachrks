name: Update Visitor Badge

on:
  push:
    branches:
      - main
  schedule:
    - cron: "0 * * * *"  # ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ÑÑ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ñ‡Ð°Ñ
  workflow_dispatch:  # ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ

permissions:
  contents: write

jobs:
  update-badge:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v3

      - name: ðŸ“Š Update Visitor Count
        run: |
          echo "ðŸ”„ Updating visitor count..."
          COUNT_FILE="visitor_count.txt"
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð»Ð¸ Ñ„Ð°Ð¹Ð»
          if [ ! -f "$COUNT_FILE" ]; then
            echo "0" > "$COUNT_FILE"
          fi
          
          # Ð§Ð¸Ñ‚Ð°ÐµÐ¼ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¸ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ ÐµÐ³Ð¾
          VISITORS=$(cat "$COUNT_FILE")
          VISITORS=$((VISITORS + 1))
          echo "$VISITORS" > "$COUNT_FILE"

      - name: ðŸŽ¨ Generate SVG Badge
        run: |
          echo "ðŸŽ¨ Creating SVG badge..."
          SVG_FILE="visitor_badge.svg"

          cat <<EOF > $SVG_FILE
          <svg width="200" height="50" xmlns="http://www.w3.org/2000/svg">
            <linearGradient id="grad" x1="0" x2="1" y1="0" y2="0">
              <stop offset="0%" stop-color="#8A2BE2"/>
              <stop offset="100%" stop-color="#1E90FF"/>
            </linearGradient>
            <rect width="200" height="50" rx="10" ry="10" fill="url(#grad)"/>
            <text x="50%" y="50%" font-size="18" font-family="Arial" fill="white" text-anchor="middle" alignment-baseline="middle">
              ðŸ‘€ Views: $VISITORS
            </text>
          </svg>
          EOF

      - name: ðŸ”„ Commit and Push Changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

          git add visitor_count.txt visitor_badge.svg
          if git diff --cached --quiet; then
            echo "âš¡ No changes to commit"
            exit 0
          fi

          git commit -m "ðŸ”„ Update visitor badge"
          git push
