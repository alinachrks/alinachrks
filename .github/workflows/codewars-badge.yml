name: Update Codewars Badge

on:
  schedule:
    - cron: "0 * * * *"  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é

permissions:
  contents: write

jobs:
  update-codewars:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout Repository
        uses: actions/checkout@v3

      - name: üîÑ Fetch Codewars Stats
        run: |
          echo "üîç Fetching Codewars stats..."
          CODEWARS_USER="alinachrks"
          API_URL="https://www.codewars.com/api/v1/users/$CODEWARS_USER"

          RESPONSE=$(curl -s "$API_URL")
          if [[ -z "$RESPONSE" || "$RESPONSE" == "null" ]]; then
            echo "‚ö†Ô∏è No response from Codewars API. Skipping update."
            exit 0
          fi

          # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ
          RANK=$(echo "$RESPONSE" | jq -r '.ranks.overall.name')
          HONOR=$(echo "$RESPONSE" | jq -r '.honor')
          CHALLENGES=$(echo "$RESPONSE" | jq -r '.codeChallenges.totalCompleted')
          PROGRESS=10  # –ü–æ–∫–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–∏–ª–∏ –º–æ–∂–Ω–æ –≤—ã—á–∏—Å–ª—è—Ç—å)

          TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S UTC")

          # –°–æ–∑–¥–∞–µ–º SVG —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
          echo "üé® Creating SVG badge..."
          SVG_FILE="codewars_badge.svg"

          cat <<EOF > $SVG_FILE
          <svg width="400" height="100" xmlns="http://www.w3.org/2000/svg">
            <linearGradient id="grad" x1="0" x2="1" y1="0" y2="0">
              <stop offset="0%" stop-color="#ff4757"/>
              <stop offset="100%" stop-color="#ff9f43"/>
            </linearGradient>
            <rect width="400" height="100" rx="15" ry="15" fill="url(#grad)"/>
            <text x="50%" y="30" font-size="20" font-family="Arial" fill="white" text-anchor="middle" alignment-baseline="middle">
              üèÜ Codewars: $RANK
            </text>
            <text x="50%" y="50" font-size="16" font-family="Arial" fill="white" text-anchor="middle" alignment-baseline="middle">
              üéñ Honor: $HONOR | üèÖ Challenges: $CHALLENGES
            </text>
            <rect x="50" y="70" width="300" height="15" rx="7" ry="7" fill="#222"/>
            <rect x="50" y="70" width="$(($PROGRESS * 3))" height="15" rx="7" ry="7" fill="#ff9f43"/>
            <text x="50%" y="83" font-size="12" font-family="Arial" fill="white" text-anchor="middle" alignment-baseline="middle">
              Progress to Next Rank: $PROGRESS%
            </text>
          </svg>
          EOF

          echo "‚úÖ Codewars badge updated!"

      - name: üîÑ Commit and Push Changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

          git add codewars_badge.svg
          if git diff --cached --quiet; then
            echo "‚ö° No changes to commit"
            exit 0
          fi

          git commit -m "üîÑ Auto-update Codewars badge"
          git pull --rebase
          git push origin main

